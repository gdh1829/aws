# ECS CAS(Container Auto Scaling)

Application-first
애플리케이션이 우선! 인프라 등은 애플리케이션에 따라온다.
인프라에 맞추어 애플리케이션이 구축되는 것이 아니라, 애플리케이션에 맞추어 인프라가 자동 구성되어야 한다.
오토스케일링이 그러한 예시 중 하나라고 볼 수 있다.

Capacity Provider - 용량공급자
ECS 서비스는 크게 Fargate 방식과 EC2 방식을 제공 중에 있다.
Fargate는 fully managed service by aws로서, ECS의 컴퓨팅 파워가 자동으로 aws에 의해 필요한 만큼 프로비저닝되며 개발자는 인프라에 대해 신경쓸 필요가 없어 간편하다. 다만, Pricing이 EC2 방식에 비해 비싸다. 자금 사정이 넉넉하지 않은 한, 선뜻 사용하기가 어렵다.

EC2 방식은
Fargate에 비해 컴퓨팅 파워 인프라에 개발자가 좀 더 세심하게 신경을 써야 한다.
자신이 세우고자 하는 애플리케이션의 요구 컴퓨팅 파워에 맞게 EC2를 직접 준비해야하는 것이다.
신경써야 할 부분이 많은 만큼 Fargate에 비해 비용이 상대적으로 훨씬 저렴하다.

ECS에서 서비스를 운영한다면, 컨테이너의 경우 손쉽게 오토스케일링으로 탄력적 서버의 수평적 확대가 아주 쉽다. 1분 이내로 컨테이너가 증설되며 트래픽을 받아들일 준비를 한다.

다만, EC2 방식인 경우, 컴퓨팅 파워 또한 매뉴얼로 관리되므로 컨테이너 수평적 확장에 대하여 EC2도 빠르게 확장 할 수가 없다.  
현재 10개의 컨테이너까지 띄울 수 있는 정도로 컴퓨팅 파워가 준비 되어 있고, 갑자기 이벤트에 의해 트래픽이 몰려 컨테이너를 20대까지 손쉽게 수평적 확대가 가능하더라도 20개까지 받아 들일 컴퓨팅 파워를 준비하기 위해서는 그 보다 더 많은 시간이 필요할 수 밖에 없다.
이런 부분에서 Fargate는 개발자가 컴퓨팅 파워라는 인프라에 대한 매니징을 자동으로 해주기 때문에(Serverless), 너무 편리하지만 항상 버짓이 문제다.

이를 해소할 수 있는 서비스로서 컨테이너의 수평적 확장에 따른 추가적 컴퓨팅 파워의 자동 확장으로서 Capacity Provider(용량공급자) 기능이 추가되었다.
물론, EC2에도 오토스케일링이라는 전통적 기능이 있지만, 컨테이너와 EC2 사이의 기준의 모호성으로 인해 사실상 힘들다. 
때문에 용량공급자 기능은 괴장히 절실했던 EC2 방식의 ECS 서비스이다.

Capacity Provider Reservation
Currently running instances M
Required total instances N
Target Reservation: N/M * 100 => 현재 총 기동중인 인스턴스 중 실제로 필요한 인스턴스 비율(%)
ex) 
100% means, 필요로 하는 컴퓨팅 파워 만큼만 EC2 인스턴스를 기동한다.
50% means, 필요로 하는 컴퓨팅 파워보다 추가적으로 50% 여유롭게 EC2 인스턴스를 기동한다. 

관리형 인스턴스 보호: 스케일인 상황시, 서비스가 실행 중인 인스턴스를 피해 빈 인스턴스를 종료하여 서비스 안정성을 높여준다. ASG에서 `인스턴스 축소 보호` 기능을 활성화 시켜두어야 용량 공급자에서도 `관리형 인스턴스 보호`기능을 활성화 할 수 있다.

Multiple Capacity Provider Stragety

기본 운영 최소 Base OD
스케일 아웃 Spot
서비스 배치 전략 Binpack 선택도 중요. 가장 비용 효율적인 배치전략으로 이 전략이 인스턴스 수를 계산하는데 영향을 주기 때문

